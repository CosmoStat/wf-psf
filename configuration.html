

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration &mdash; wf-psf 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9570fddd" />
      <link rel="stylesheet" type="text/css" href="_static/twemoji.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=309026bb" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=af2ce170"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js"></script>
      <script src="_static/twemoji.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="Basic Execution" href="basic_execution.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ffb400" >

          
          
          <a href="index.html" class="icon icon-home">
            wf-psf
              <img src="_static/cosmostat_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About WaveDiff</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installing WaveDiff</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Running WaveDiff</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basic_execution.html">Basic Execution</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-pipeline-tasks">Overview of Pipeline Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file-structure">Configuration File Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-config-yaml-data-configuration"><code class="docutils literal notranslate"><span class="pre">data_config.yaml</span></code> — Data Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#purpose">1. Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-fields">2. Key Fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#training-config-yaml-training-pipeline-configuration"><code class="docutils literal notranslate"><span class="pre">training_config.yaml</span></code> — Training Pipeline Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">1. Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-notes">2. General Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#top-level-training-parameters">3. Top-Level Training Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-parameters-model-params">4. Model Parameters (<code class="docutils literal notranslate"><span class="pre">model_params</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parametric-model-hyperparameters-param-hparams">5. Parametric Model Hyperparameters (<code class="docutils literal notranslate"><span class="pre">param_hparams</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-parametric-model-hyperparameters-nonparam-hparams">6. Non-Parametric Model Hyperparameters (<code class="docutils literal notranslate"><span class="pre">nonparam_hparams</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-hyperparameters-training-hparams">7. Training Hyperparameters (<code class="docutils literal notranslate"><span class="pre">training_hparams</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#metrics-config-yaml-metrics-configuration"><code class="docutils literal notranslate"><span class="pre">metrics_config.yaml</span></code>  — Metrics Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">1. Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">2. General Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metrics-overview">3. Metrics Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#top-level-configuration-parameters">4. Top-Level Configuration Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ground-truth-model-parameters">5. Ground Truth Model Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluation-hyperparameters">6. Evaluation Hyperparameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-config-yaml-plot-configuration"><code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> — Plot Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">1. Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">2. General Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-structure">3. Basic Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#master-configuration">Master Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">1. Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-multiple-training-runs">2. Example: Multiple Training Runs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-training-metrics-plotting">3 Example: Training + Metrics + Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">4 General Notes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="z_ref.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ffb400" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">wf-psf</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/configuration.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h1>
<p>WaveDiff uses a set of YAML and INI configuration files to control each pipeline task.
This section provides a high-level overview of the configuration system, followed by detailed explanations of each file.</p>
<section id="overview-of-pipeline-tasks">
<h2>Overview of Pipeline Tasks<a class="headerlink" href="#overview-of-pipeline-tasks" title="Link to this heading"></a></h2>
<p>WaveDiff consists of four main pipeline tasks:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pipeline</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">training</span></code></p></td>
<td><p>Trains a PSF model using the provided dataset and hyperparameters.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">metrics</span></code></p></td>
<td><p>Evaluates model performance using multiple metrics, optionally comparing against a ground-truth model.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">plotting</span></code></p></td>
<td><p>Generates figures summarizing the results from the metrics pipeline.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sims</span></code></p></td>
<td><p>Simulates stellar PSFs used as training/test datasets.<br><em>(Currently executed via a standalone script, not via <code class="docutils literal notranslate"><span class="pre">wavediff</span></code>.)</em></p></td>
</tr>
</tbody>
</table>
<p>You configure these tasks by passing a configuration file to the <code class="docutils literal notranslate"><span class="pre">wavediff</span></code> command (e.g., <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">configs.yaml</span></code>).</p>
</section>
<section id="configuration-file-structure">
<h2>Configuration File Structure<a class="headerlink" href="#configuration-file-structure" title="Link to this heading"></a></h2>
<p>WaveDiff expects the following configuration files under the <code class="docutils literal notranslate"><span class="pre">config/</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>config
├── configs.yaml
├── data_config.yaml
├── logging.conf
├── metrics_config.yaml
├── plotting_config.yaml
└── training_config.yaml
</pre></div>
</div>
<ul class="simple">
<li><p>All <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> files use standard <strong>YAML</strong> syntax and are loaded as nested dictionaries of key–value pairs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logging.conf</span></code> uses standard <strong>INI</strong> syntax and configures logging behavior.</p></li>
<li><p>Users may modify values but should <strong>not rename keys or section names</strong>, as the software depends on them.</p></li>
</ul>
<p>Each of the configuration files is described in detail below.</p>
</section>
<section id="data-config-yaml-data-configuration">
<span id="data-config"></span><h2><code class="docutils literal notranslate"><span class="pre">data_config.yaml</span></code> — Data Configuration<a class="headerlink" href="#data-config-yaml-data-configuration" title="Link to this heading"></a></h2>
<section id="purpose">
<h3>1. Purpose<a class="headerlink" href="#purpose" title="Link to this heading"></a></h3>
<p>Specifies where WaveDiff loads (or later versions may generate) the training and test datasets.<br />
All training, evaluation, and metrics pipelines depend on this file for consistent dataset paths.</p>
</section>
<section id="key-fields">
<h3>2. Key Fields<a class="headerlink" href="#key-fields" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data.training.data_dir</span></code> <em>(required)</em> — directory containing training data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.training.file</span></code> <em>(required)</em> — filename of the training dataset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.test.*</span></code> — same structure as <code class="docutils literal notranslate"><span class="pre">training</span></code>, for the test dataset</p></li>
<li><p><strong>Simulation-related fields</strong> — reserved for future releases</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>The simulation options are placeholders; WaveDiff v3.x does <strong>not yet</strong> auto-generate datasets.</p></li>
<li><p>The default dataset bundled with WaveDiff can be used by simply pointing to its directory.</p></li>
</ul>
<p><strong>Example (minimal)</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">training</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/training/data</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train.npy</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/test/data</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test.npy</span>
</pre></div>
</div>
</section>
</section>
<section id="training-config-yaml-training-pipeline-configuration">
<span id="training-config"></span><h2><code class="docutils literal notranslate"><span class="pre">training_config.yaml</span></code> — Training Pipeline Configuration<a class="headerlink" href="#training-config-yaml-training-pipeline-configuration" title="Link to this heading"></a></h2>
<section id="id1">
<h3>1. Purpose<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Controls the training pipeline, including model selection, hyperparameters, optional metrics evaluation, and data loading behavior.</p>
</section>
<section id="general-notes">
<h3>2. General Notes<a class="headerlink" href="#general-notes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Every field has an inline comment in the YAML file.</p></li>
<li><p><strong>All required parameters must be specified.</strong> Missing values will prevent the model from being instantiated, as there is currently no default configuration provided.</p></li>
<li><p><strong>Optional fields:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">metrics_config</span></code> (run metrics after training)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param_hparams</span></code>, <code class="docutils literal notranslate"><span class="pre">nonparam_hparams</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multi_cycle_params.save_all_cycles</span></code></p></li>
</ul>
</li>
<li><p>Some parameters are specific to physical or polychromatic PSF models.</p></li>
<li><p>Example training configuration file is provided in the top-level root directory of the repository (<code class="docutils literal notranslate"><span class="pre">training_config.yaml</span></code>). Users can copy and adapt this template for their own runs.</p></li>
<li><p>If any descriptions are unclear, or unexpected behaviour occurs, please open a <a class="reference external" href="https://github.com/CosmoStat/wf-psf/issues/new">GitHub issue</a>.</p></li>
</ul>
<p><strong>Note:</strong> The values in the examples shown below correspond to a typical WaveDiff training run. Users should adapt parameters such as <code class="docutils literal notranslate"><span class="pre">model_name</span></code>, telescope dimensions, pixel/field coordinates, and SED settings to match their own instrument or dataset. All required fields must still be specified.</p>
</section>
<section id="top-level-training-parameters">
<h3>3. Top-Level Training Parameters<a class="headerlink" href="#top-level-training-parameters" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">training</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ID name for this run (used in output files)</span>
<span class="w">  </span><span class="nt">id_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run__001</span>

<span class="w">  </span><span class="c1"># Path to Data Configuration file (required)</span>
<span class="w">  </span><span class="nt">data_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_config.yaml</span><span class="w"> </span>

<span class="w">  </span><span class="c1"># Load dataset on initialization (True) or manually later (False)</span>
<span class="w">  </span><span class="nt">load_data_on_init</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="w">  </span><span class="c1"># Optional: metrics configuration to run after training</span>
<span class="w">  </span><span class="nt">metrics_config</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="model-parameters-model-params">
<h3>4. Model Parameters (<code class="docutils literal notranslate"><span class="pre">model_params</span></code>)<a class="headerlink" href="#model-parameters-model-params" title="Link to this heading"></a></h3>
<p>Controls PSF model type, geometry, oversampling, and preprocessing:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">model_params</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Model type. Options: &#39;poly&#39; and &#39;physical_poly&#39;</span>
<span class="w">  </span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">physical_poly</span>

<span class="w">  </span><span class="c1"># Number of wavelength bins for polychromatic reconstruction</span>
<span class="w">  </span><span class="nt">n_bins_lda</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"> </span>

<span class="w">  </span><span class="c1"># Downsampling rate to match telescope pixel sampling</span>
<span class="w">  </span><span class="nt">output_Q</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="c1"># Oversampling rate of OPD/WFE PSF model</span>
<span class="w">  </span><span class="nt">oversampling_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="c1"># Pixel PSF postage stamp size</span>
<span class="w">  </span><span class="nt">output_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>

<span class="w">  </span><span class="c1"># OPD/Wavefront space dimensions</span>
<span class="w">  </span><span class="nt">pupil_diameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>

<span class="w">  </span><span class="c1"># Physical correction switches</span>
<span class="w">  </span><span class="nt">use_prior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">correct_centroids</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">add_ccd_misalignments</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>

<span class="w">  </span><span class="c1"># Centroid correction parameters</span>
<span class="w">  </span><span class="nt">sigma_centroid_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.5</span><span class="w">       </span><span class="c1"># Std dev of centroiding window</span>
<span class="w">  </span><span class="nt">reference_shifts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-1/3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">-1/3</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># Euclid-like default shifts</span>

<span class="w">  </span><span class="c1"># Obscuration / geometry</span>
<span class="w">  </span><span class="nt">obscuration_rotation_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">    </span><span class="c1"># Degrees (multiple of 90); counterclockwise rotation. </span>

<span class="w">  </span><span class="c1"># CCD misalignments input file path</span>
<span class="w">  </span><span class="nt">ccd_misalignments_input_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/ccd_misalignments_file.txt</span>
<span class="w">    </span>
<span class="w">  </span><span class="c1"># Boolean to use sample weights based on the noise standard deviation estimation</span>
<span class="w">  </span><span class="nt">use_sample_weights</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span>

<span class="w">  </span><span class="c1"># Sample weight generalised sigmoid function</span>
<span class="w">  </span><span class="nt">sample_weights_sigmoid</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Boolean to define if we apply the sigmoid function to the sample weights</span>
<span class="w">    </span><span class="nt">apply_sigmoid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="c1"># Maximum value of the sigmoid function and consequently the maximum value of the sample weights</span>
<span class="w">    </span><span class="nt">sigmoid_max_val</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">    </span><span class="c1"># Power of the sigmoid function. The higher the value the steeper the sigmoid function. In the limit</span>
<span class="w">    </span><span class="nt">sigmoid_power_k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>

<span class="w">  </span><span class="c1"># Interpolation settings for physical-poly model</span>
<span class="w">  </span><span class="nt">interpolation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">interpolation_args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>

<span class="w">  </span><span class="c1"># Spectral energy distribution (SED) parameters</span>
<span class="w">  </span><span class="nt">sed_interp_pts_per_bin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">sed_extrapolate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">sed_interp_kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linear</span>
<span class="w">  </span><span class="nt">sed_sigma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="w">  </span><span class="c1"># Field and pixel coordinates</span>
<span class="w">  </span><span class="nt">x_lims</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e3</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">y_lims</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e3</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pix_sampling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span><span class="w">       </span><span class="c1"># in [um]</span>

<span class="w">  </span><span class="c1"># Telescope parameters</span>
<span class="w">  </span><span class="nt">tel_diameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2</span><span class="w">      </span><span class="c1"># [m]</span>
<span class="w">  </span><span class="nt">tel_focal_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24.5</span><span class="w"> </span><span class="c1"># [m]</span>
<span class="w">  </span><span class="nt">euclid_obsc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True.</span><span class="w">     </span><span class="c1"># Use Euclid-specific obscuration mask. Set to False for other instruments or custom masks.</span>
<span class="w">  </span><span class="nt">LP_filter_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">    </span><span class="c1"># Low-pass filter for obscurations</span>
</pre></div>
</div>
</section>
<section id="parametric-model-hyperparameters-param-hparams">
<h3>5. Parametric Model Hyperparameters (<code class="docutils literal notranslate"><span class="pre">param_hparams</span></code>)<a class="headerlink" href="#parametric-model-hyperparameters-param-hparams" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">param_hparams</span><span class="p">:</span>
<span class="w">  </span><span class="nt">random_seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3877572</span>
<span class="w">  </span><span class="nt">l2_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w">             </span><span class="c1"># L2 loss for OPD/WFE</span>
<span class="w">  </span><span class="nt">n_zernikes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">d_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">                  </span><span class="c1"># Max polynomial degree</span>
<span class="w">  </span><span class="nt">save_optim_history_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</section>
<section id="non-parametric-model-hyperparameters-nonparam-hparams">
<h3>6. Non-Parametric Model Hyperparameters (<code class="docutils literal notranslate"><span class="pre">nonparam_hparams</span></code>)<a class="headerlink" href="#non-parametric-model-hyperparameters-nonparam-hparams" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nonparam_hparams</span><span class="p">:</span>
<span class="w">  </span><span class="nt">d_max_nonparam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">num_graph_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">l1_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-8</span>
<span class="w">  </span><span class="nt">project_dd_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">reset_dd_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">save_optim_history_nonparam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</section>
<section id="training-hyperparameters-training-hparams">
<h3>7. Training Hyperparameters (<code class="docutils literal notranslate"><span class="pre">training_hparams</span></code>)<a class="headerlink" href="#training-hyperparameters-training-hparams" title="Link to this heading"></a></h3>
<p>Controls batches, loss, and multi-cycle learning:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">training_hparams</span><span class="p">:</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">           </span><span class="c1"># Number of samples per batch</span>
<span class="w">  </span><span class="nt">loss</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;mask_mse&#39;</span><span class="w">         </span><span class="c1"># Options: &#39;mask_mse&#39;, &#39;mse&#39;</span>

<span class="w">  </span><span class="nt">multi_cycle_params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">total_cycles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">cycle_def</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">complete</span><span class="w">        </span><span class="c1"># Options: &#39;parametric&#39;, &#39;non-parametric&#39;, &#39;complete&#39;, etc.</span>
<span class="w">    </span><span class="nt">save_all_cycles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">saved_cycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cycle2</span>

<span class="w">    </span><span class="nt">learning_rate_params</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.0e-2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e-2</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">learning_rate_non_params</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.0e-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e-1</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">n_epochs_params</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">n_epochs_non_params</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">100</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">120</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
</section>
<section id="metrics-config-yaml-metrics-configuration">
<span id="metrics-config"></span><h2><code class="docutils literal notranslate"><span class="pre">metrics_config.yaml</span></code>  — Metrics Configuration<a class="headerlink" href="#metrics-config-yaml-metrics-configuration" title="Link to this heading"></a></h2>
<section id="id2">
<h3>1. Purpose<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>Defines how a trained PSF model is evaluated. This configuration specifies which metrics to compute, which model weights to use, and how ground truth stars are obtained. It allows you to:</p>
<ul class="simple">
<li><p>Select a fully trained PSF model or a checkpoint for evaluation.</p></li>
<li><p>Specify which training cycle’s weights to evaluate.</p></li>
<li><p>Compute Polychromatic, Monochromatic, OPD, and Weak Lensing Shape metrics.</p></li>
<li><p>Use precomputed ground truth stars from the dataset if available, or automatically generate them from the configured ground truth model.</p></li>
<li><p>Optionally produce plots of the computed metrics via a plotting configuration file.</p></li>
</ul>
</section>
<section id="id3">
<h3>2. General Notes<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>WaveDiff automatically searches the dataset used for training. If the dataset contains <code class="docutils literal notranslate"><span class="pre">stars</span></code>, <code class="docutils literal notranslate"><span class="pre">SR_stars</span></code>, or <code class="docutils literal notranslate"><span class="pre">super_res_stars</span></code> fields, these are used as the ground truth for metrics evaluation.</p></li>
<li><p>If precomputed ground truth stars are not found in the dataset, WaveDiff regenerates them using the <code class="docutils literal notranslate"><span class="pre">ground_truth_model</span></code> parameters. <strong>All required fields in <code class="docutils literal notranslate"><span class="pre">model_params</span></code> must be specified</strong>; leaving them empty will prevent the metrics pipeline from running (see <a class="reference internal" href="#section-ground-truth-model"><span class="std std-ref">Ground Truth Model Parameters</span></a> for details).</p></li>
<li><p>The metrics evaluation can be run independently of training by specifying trained_model_path and <code class="docutils literal notranslate"><span class="pre">trained_model_config</span></code>.</p></li>
<li><p>Metrics defined in <a class="reference internal" href="#metrics-table"><span class="std std-ref">Metrics Overview table</span></a> are selectively computed according to their boolean flags. The Polychromatic Pixel Reconstruction metric is always computed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">plotting_config</span></code> parameter triggers plotting of the metrics results if a valid configuration file is provided. If left empty, metrics are computed without generating plots (see <a class="reference internal" href="#section-plotting-config"><span class="std std-ref">Plotting Configuration</span></a>).</p></li>
<li><p>Batch size and other evaluation hyperparameters can be set under <code class="docutils literal notranslate"><span class="pre">metrics_hparams</span></code> (see <a class="reference internal" href="#section-evaluation-hyperparameters"><span class="std std-ref">Evaluation Hyperparameters</span></a>)</p></li>
</ul>
</section>
<section id="metrics-overview">
<span id="section-metrics-overview"></span><h3>3. Metrics Overview<a class="headerlink" href="#metrics-overview" title="Link to this heading"></a></h3>
<table class="docutils align-default" id="metrics-table">
<thead>
<tr class="row-odd"><th class="head"><p>Metric type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Relevant v3.0 Flag</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Polychromatic Pixel Reconstruction</p></td>
<td><p>Computes absolute and relative RMSE of pixel residuals between the trained polychromatic PSF model and test data at low- and super-pixel resolution.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">eval_train_shape_results_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_test_shape_results_dict</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Monochromatic Pixel Reconstruction</p></td>
<td><p>Computes absolute and relative RMSE of pixel residuals as a function of wavelength between a monochromatic PSF model and test data.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">eval_mono_metric</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Optical Path Differences (OPD)</p></td>
<td><p>Computes absolute and relative RMSE of residuals between predicted OPD maps and ground truth OPD.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">eval_opd_metric</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Weak Lensing Shape Metrics</p></td>
<td><p>Second-order moments-based metrics for PSF ellipticity and size at super-pixel resolution using <a class="reference external" href="https://galsim-developers.github.io/GalSim/_build/html/hsm.html">GalSim HSM</a>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">eval_train_shape_results_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_test_shape_results_dict</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li><p>Metrics requiring ground truth (Monochromatic, OPD) are valid only on simulated datasets.</p></li>
<li><p>RMSE may be less reliable for noisy stars (e.g., real data). Alternative formulations are in development.</p></li>
<li><p>Super-resolution is required for Weak Lensing Shape metrics on undersampled PSFs (e.g., Euclid observations).</p></li>
</ul>
</section>
<section id="top-level-configuration-parameters">
<h3>4. Top-Level Configuration Parameters<a class="headerlink" href="#top-level-configuration-parameters" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;enter psf_model or checkpoint&gt;</span>
<span class="w">  </span><span class="nt">saved_training_cycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">trained_model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;/path/to/parent/directory/of/trained/model&gt;</span>
<span class="w">  </span><span class="nt">trained_model_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;enter name of trained model config file&gt;</span>
<span class="w">  </span><span class="nt">eval_mono_metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">eval_opd_metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">eval_train_shape_results_dict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">eval_test_shape_results_dict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">plotting_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;enter name of plotting_config.yaml or leave empty&gt;</span>
</pre></div>
</div>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_save_path</span></code>: Load final PSF model weights (<code class="docutils literal notranslate"><span class="pre">psf_model</span></code>) or checkpoint weights (<code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saved_training_cycle</span></code>: Choose which training cycle to evaluate (1, 2, …).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trained_model_path</span></code>: Absolute path to parent directory of previously trained model. Leave empty for training + metrics in serial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trained_model_config</span></code>: Name of training config file in <code class="docutils literal notranslate"><span class="pre">trained_model_path/config/</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_mono_metric</span></code>: If True, computes the monochromatic pixel reconstruction metric. Requires a <code class="docutils literal notranslate"><span class="pre">ground_truth_model</span></code> (see).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_opd_metric</span></code>: If True, computes the optical path difference (OPD) metric. Requires a <code class="docutils literal notranslate"><span class="pre">ground_truth_model</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_train_shape_results_dict</span></code> / <code class="docutils literal notranslate"><span class="pre">eval_test_shape_results_dict</span></code>: Compute Weak Lensing Shape metrics on the training and/or test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plotting_config:</span></code> Optionally provide a <code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> file to generate plots after metrics evaluation.</p></li>
<li><p><strong>Behaviour notes:</strong></p>
<ul>
<li><p>Metrics controlled by flags (<code class="docutils literal notranslate"><span class="pre">eval_mono_metric</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_opd_metric</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_train_shape_results_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">eval_test_shape_results_dict</span></code>) are only computed if their respective flags are True.</p></li>
<li><p>The Polychromatic Pixel Reconstruction metric is always computed, regardless of flags.</p></li>
<li><p>Future releases may allow optional <code class="docutils literal notranslate"><span class="pre">ground_truth_model</span></code> instantiation if the dataset already contains precomputed stars.</p></li>
</ul>
</li>
</ul>
</section>
<section id="ground-truth-model-parameters">
<span id="section-ground-truth-model"></span><h3>5. Ground Truth Model Parameters<a class="headerlink" href="#ground-truth-model-parameters" title="Link to this heading"></a></h3>
<p>Mirrors training parameters for consistency:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ground_truth_model</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ground_truth_poly or ground_truth_physical_poly&gt;</span>
<span class="w">    </span><span class="nt">n_bins_lda</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">    </span><span class="nt">output_Q</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">oversampling_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">output_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">    </span><span class="nt">pupil_diameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="w">    </span><span class="nt">LP_filter_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">use_sample_weights</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">use_prior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">correct_centroids</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">sigma_centroid_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.5</span>
<span class="w">    </span><span class="nt">reference_shifts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-1/3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">-1/3</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">obscuration_rotation_angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">add_ccd_misalignments</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">ccd_misalignments_input_path</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">interpolation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">    </span><span class="nt">sed_interp_pts_per_bin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">sed_extrapolate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">sed_interp_kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linear</span>
<span class="w">    </span><span class="nt">sed_sigma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">x_lims</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e+3</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">y_lims</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0e+3</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">param_hparams</span><span class="p">:</span>
<span class="w">      </span><span class="nt">random_seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3877572</span>
<span class="w">      </span><span class="nt">l2_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span>
<span class="w">      </span><span class="nt">n_zernikes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">45</span>
<span class="w">      </span><span class="nt">d_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">save_optim_history_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">nonparam_hparams</span><span class="p">:</span>
<span class="w">      </span><span class="nt">d_max_nonparam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">num_graph_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">l1_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0e-8</span>
<span class="w">      </span><span class="nt">project_dd_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">reset_dd_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">save_optim_history_nonparam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li><p><strong>All fields in <code class="docutils literal notranslate"><span class="pre">model_params</span></code> are required.</strong> Do not leave them empty. Even if the dataset contains precomputed ground truth stars, omitting <code class="docutils literal notranslate"><span class="pre">model_params</span></code> will prevent the metrics pipeline from running.</p></li>
<li><p>Parameters mirror <code class="docutils literal notranslate"><span class="pre">training_config.yaml</span></code> for consistency.</p></li>
<li><p>Future releases may allow optional instantiation of <code class="docutils literal notranslate"><span class="pre">ground_truth_model</span></code> when precomputed stars are available in the dataset.</p></li>
</ul>
</section>
<section id="evaluation-hyperparameters">
<span id="section-evaluation-hyperparameters"></span><h3>6. Evaluation Hyperparameters<a class="headerlink" href="#evaluation-hyperparameters" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">metrics_hparams</span><span class="p">:</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">  </span><span class="nt">opt_stars_rel_pix_rmse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">l2_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span>
<span class="w">  </span><span class="nt">output_Q</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">output_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
</pre></div>
</div>
<p><strong>Parameter explanations:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: Number of samples processed per batch during evaluation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opt_stars_rel_pix_rmse</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, saves RMSE for each individual star in addition to mean across FOV.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_param</span></code>: L2 loss weight for OPD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_Q</span></code>: Downsampling rate from high-resolution pixel modeling space.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_dim</span></code>: Size of the PSF postage stamp for evaluation.</p></li>
</ul>
</section>
</section>
<section id="plotting-config-yaml-plot-configuration">
<span id="section-plotting-config"></span><h2><code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> — Plot Configuration<a class="headerlink" href="#plotting-config-yaml-plot-configuration" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> file defines how WaveDiff generates diagnostic plots from the metrics produced during model evaluation. While the plotting routines are mostly pre-configured internally, this file allows you to combine and compare metrics from multiple training runs, or simply visualize the results of the most recent <code class="docutils literal notranslate"><span class="pre">metrics</span></code> pipeline execution.</p>
<section id="id4">
<h3>1. Purpose<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>This configuration controls how metric outputs from one or more WaveDiff runs are located and aggregated for plotting. It enables users to:</p>
<ul class="simple">
<li><p>Specify where metrics outputs are stored,</p></li>
<li><p>Select which runs to include in joint plots,</p></li>
<li><p>Associate each run with its corresponding <code class="docutils literal notranslate"><span class="pre">metrics_config.yaml</span></code>,</p></li>
<li><p>Optionally display plots interactively during execution.</p></li>
</ul>
</section>
<section id="id5">
<h3>2. General Notes<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>All plotting styles and figure settings are hard-coded and do not require user modification.</p></li>
<li><p>If the plotting task is executed immediately after a metrics evaluation run, all fields except <code class="docutils literal notranslate"><span class="pre">plot_show</span></code> may be left empty—the pipeline will automatically locate the outputs of the active run.</p></li>
<li><p>When plotting results from multiple runs, the entries in <code class="docutils literal notranslate"><span class="pre">metrics_dir</span></code> and <code class="docutils literal notranslate"><span class="pre">metrics_config</span></code> must appear <strong>row-aligned</strong>, with each position referring to the same run.</p></li>
<li><p>If any descriptions are unclear, or if you encounter unexpected behavior, please open a GitHub issue (<a class="reference external" href="https://github.com/CosmoStat/wf-psf/issues/new">https://github.com/CosmoStat/wf-psf/issues/new</a>).</p></li>
</ul>
</section>
<section id="basic-structure">
<h3>3. Basic Structure<a class="headerlink" href="#basic-structure" title="Link to this heading"></a></h3>
<p>An example <code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> is shown below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plotting_params</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Path to the parent folder containing wf-psf output directories (e.g. $WORK/wf-outputs/)</span>
<span class="w">  </span><span class="nt">metrics_output_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH&gt;</span>

<span class="w">  </span><span class="c1"># List of output directories (e.g. wf-outputs-xxxxxxxxxxx) whose metrics should be plotted</span>
<span class="w">  </span><span class="nt">metrics_dir</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># - wf-outputs-xxxxxxxxxxx1</span>
<span class="w">    </span><span class="c1"># - wf-outputs-xxxxxxxxxxx2</span>

<span class="w">  </span><span class="c1"># List of the metric config filenames corresponding to each listed directory</span>
<span class="w">  </span><span class="nt">metrics_config</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># - metrics_config_1.yaml</span>
<span class="w">    </span><span class="c1"># - metrics_config_2.yaml</span>

<span class="w">  </span><span class="c1"># If True, plots are shown interactively during execution</span>
<span class="w">  </span><span class="nt">plot_show</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>### 4. Example Directory Structure
Below is an example of three WaveDiff runs stored under a single parent directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wf-outputs/
├── wf-outputs-202305271829
│   ├── config
│   │   ├── data_config.yaml
│   │   └── metrics_config_200.yaml
│   ├── metrics
│   │   └── metrics-poly-coherent_euclid_200stars.npy
├── wf-outputs-202305271845
│   ├── config
│   │   ├── data_config.yaml
│   │   └── metrics_config_500.yaml
│   ├── metrics
│   │   └── metrics-poly-coherent_euclid_500stars.npy
├── wf-outputs-202305271918
│   ├── config
│   │   ├── data_config.yaml
│   │   └── metrics_config_1000.yaml
│   ├── metrics
│   │   └── metrics-poly-coherent_euclid_1000stars.npy
</pre></div>
</div>
<p><strong>Example: Plotting Multiple Runs</strong>
To jointly plot metrics from the three runs shown above, the <code class="docutils literal notranslate"><span class="pre">plotting_config.yaml</span></code> would be:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plotting_params</span><span class="p">:</span>
<span class="w">  </span><span class="nt">metrics_output_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$WORK/wf-outputs/</span>

<span class="w">  </span><span class="nt">metrics_dir</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wf-outputs-202305271829</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wf-outputs-202305271845</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wf-outputs-202305271918</span>

<span class="w">  </span><span class="nt">metrics_config</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics_config_200.yaml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics_config_500.yaml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics_config_1000.yaml</span>

<span class="w">  </span><span class="nt">plot_show</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>This configuration instructs the plotting pipeline to load the metrics from each listed run and include them together in summary plots.</p>
</section>
</section>
<section id="master-configuration">
<span id="master-config-file"></span><h2>Master Configuration<a class="headerlink" href="#master-configuration" title="Link to this heading"></a></h2>
<section id="id6">
<h3>1. Purpose<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">configs.yaml</span></code> file is the <em>master controller</em> for WaveDiff.
It defines <strong>which pipeline tasks</strong> should be executed (training, metrics evaluation, plotting) and in which order.</p>
<p>Each task points to a dedicated YAML configuration file—allowing WaveDiff to run multiple jobs sequentially using a single entry point.</p>
</section>
<section id="example-multiple-training-runs">
<h3>2. Example: Multiple Training Runs<a class="headerlink" href="#example-multiple-training-runs" title="Link to this heading"></a></h3>
<p>To launch a sequence of training runs (models 1…n), list each task and its corresponding configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="w">  </span><span class="nt">training_conf_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">training_config_1.yaml</span>
<span class="w">  </span><span class="nt">training_conf_2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">training_config_2.yaml</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">training_conf_n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">training_config_n.yaml</span>
</pre></div>
</div>
<p>Outputs will be organized as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wf-outputs-20231119151932213823/
├── checkpoint/
│   ├── checkpoint_callback_poly-coherent_euclid_200stars_1_cycle1.*
│   ├── ...
│   ├── checkpoint_callback_poly-coherent_euclid_200stars_n_cycle1.*
├── config/
│   ├── configs.yaml
│   ├── data_config.yaml
│   ├── training_config_1.yaml
│   ├── ...
│   └── training_config_n.yaml
├── optim-hist/
├── plots/
└── psf_model/
    ├── psf_model_poly-coherent_euclid_200stars_1_cycle1.*
    ├── ...
    └── psf_model_poly-coherent_euclid_200stars_n_cycle1.*
</pre></div>
</div>
</section>
<section id="example-training-metrics-plotting">
<h3>3 Example: Training + Metrics + Plotting<a class="headerlink" href="#example-training-metrics-plotting" title="Link to this heading"></a></h3>
<p>To evaluate metrics and generate plots for each trained model, include the corresponding configuration files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>config/
├── configs.yaml
├── data_config.yaml
├── metrics_config.yaml
├── plotting_config.yaml
├── training_config_1.yaml
├── ...
└── training_config_n.yaml
</pre></div>
</div>
<p>Note: current WaveDiff versions generate one plot per metric per model. Creating combined plots requires a separate run <a class="reference internal" href="#section-plotting-config"><span class="std std-ref">Plot Configuration</span></a>. . A future update will support automatic combined plots.</p>
</section>
<section id="id7">
<h3>4 General Notes<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">configs.yaml</span></code> may contain <strong>any combination</strong> of the three task types:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">training</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metrics</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plotting</span></code></p></li>
</ul>
</li>
<li><p>Tasks always execute <strong>in the order they appear</strong> in the file.</p></li>
<li><p>The current release runs all jobs on a single GPU, sequentially.</p></li>
<li><p>Parallel multi-GPU execution is planned for a future version.</p></li>
<li><p>For questions or feedback, please open a <a class="reference external" href="https://github.com/CosmoStat/wf-psf/issues/new">GitHub issue</a>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="basic_execution.html" class="btn btn-neutral float-left" title="Basic Execution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023–2026, CosmoStat.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>